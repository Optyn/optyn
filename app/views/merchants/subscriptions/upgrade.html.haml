= display_title "Upgrade your Account"
= banner("Pricing and Invoices")

= render partial: 'merchants/merchant_managers/tabs'

.row-fluid.text-center
  .well.span3
    %h5 You Current Plan:
    = "#{@plan.min} " " - "
    = " #{@plan.max}" " Customers"
    %br
    = link_to "view plans","/pricing"
  .well.span3
    %h5 Last Payment:
  .well.span3
    %h5 Upcoming Payment:
    %p
    = "$#{@plan.amount} " " on" " #{@stripe_upcoming_payment}"
    %p
    (pricing tier may change)
  .well.span3
    %h5 Credit Card on File:
    %p ending in 
    %br
    %a.btn{ 'href' => '#get-payment-info', 'role' => 'button', 'data-toggle' => 'modal' } Update Card

.blank-space

.row-fluid.payment-errors
  - if @subscription.errors.any? || @subscription.stripe_error
    =@subscription.stripe_error
    %ul
      - @subscription.errors.full_messages.each do |error|
        %li
          = error  

.row-fluid
  .span12
    %h2 Your Payment History
    %table.table.table-striped.table-hover
      %thead
        %tr
          %td Date
          %td Amount
          %td Plan
          %td View invoice
      %tbody
        %tr
          %td xx-xx-xxxx
          %td $X.X
          %td Foo
          %td Bar



= form_for @subscription, :url => merchants_subscribe_path ,:html=>{:id =>"stripe-form"} do |f|
  .modal.hide.fade#get-payment-info
    .modal-header
      %h4 Enter Your Payment Information
    .modal-body
      .form.row-fluid

        = f.hidden_field :plan_id, :value => @plan.id
        = f.hidden_field :email, :value => current_merchants_manager.email
        = f.hidden_field :shop_id, :value => current_merchants_manager.shop.id

        = hidden_field_tag :stripe_plan_id,nil, :value => @plan.plan_id

        .blank-space

        .row-fluid
          = text_field_tag :credit_card, nil,:placeholder => "16 digit Credit card number",:autocomplete=>"off",:class=>'credit-number pull-left span6', 'data-toggle' => 'tooltip', title: 'Your 16 digit Credit Card number'

          = text_field_tag :cvv,nil, :placeholder => "CVV",:class=>'credit-security span6', 'data-toggle' => 'tooltip', title: 'CVV'

        .blank-space

        .row-fluid
          = select_month(Date.today, {},{:class => "card-expiry-month pull-left selectbox span12", 'data-toggle' => 'tooltip', title: 'Card expiry month'})

        .blank-space

        .row-fluid
          = select_year(Date.today,{:start_year => Date.today.year },{:class => "card-expiry-year pull-left selectbox span12", 'data-toggle' => 'tooltip', title: 'Card expiry year'})

      %div{:style => "text-align: center; margin-top: 25px;"}
        %p
          All payments are processed securely.
    .modal-footer
      %a.btn( href='#' )Close
      = f.submit "Pay", :class => "btn btn-success"

:javascript
  $( document ).ready( equalizeDivHeights( '.well.span3' ));
